<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Rust Style Guide · Enso Developer Documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="The developer documentation for the Enso compiler, runtime, and IDE..
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Enso.org"><link rel="stylesheet" href="/docs/developer/gitbook/style.css">
<link rel="stylesheet" href="/docs/developer/gitbook/gitbook-plugin-fontsettings/website.css">
<!-- <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css"> -->

<link rel="stylesheet" href="/docs/developer/gitbook/rouge-highlight-colorful.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/docs/developer/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/docs/developer/gitbook/images/favicon.ico" type="image/x-icon">
        

        
        


        
        
        

        
        
        

        
            <link rel="prev" href="/docs/developer/enso/style-guide/java.html" />
        

        
            <link rel="next" href="/docs/developer/enso/style-guide/haskell.html" />
        
    </head>
    <body>
        
        <div class="book"><div class="book-summary">
    <div id="search-searchbar">
    </div>
    <div class="post-list" id="search-hits">
        
      </div>
      <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>
    <nav role="navigation">
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/">
            
                <a href="/docs/developer/">
                    Home
                </a>
            </li>

            <li class="divider"></li>
            
            
            
            
            

            
            
        
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide ">
                    <a href="/docs/developer/enso/style-guide">
                        Go back
                    </a>
                </li>
                <li class="divider"></li>
            
                
             
            
            
            
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide/">
                    
                        <a href="/docs/developer/enso/style-guide/">
                            
                                Enso Developer Style Guides
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide/scala.html">
                    
                        <a href="/docs/developer/enso/style-guide/scala.html">
                            
                                Scala Style Guide
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide/java.html">
                    
                        <a href="/docs/developer/enso/style-guide/java.html">
                            
                                Java Style Guide
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter active" data-level="1.2" data-path="/docs/developer/enso/style-guide/rust.html">
                    
                        <a href="/docs/developer/enso/style-guide/rust.html">
                            
                                Rust Style Guide
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide/haskell.html">
                    
                        <a href="/docs/developer/enso/style-guide/haskell.html">
                            
                                Haskell Style Guide
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide/markdown.html">
                    
                        <a href="/docs/developer/enso/style-guide/markdown.html">
                            
                                Markdown Style Guide
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/style-guide/yaml.html">
                    
                        <a href="/docs/developer/enso/style-guide/yaml.html">
                            
                                YAML Style Guide
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            

            
        
        </ul>
    </nav>
</div>
<div class="book-body"><div class="body-inner">
    <div class="book-header" role="navigation">
        <!-- Title -->
        <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
                <a href="." >Rust Style Guide</a>
            
        </h1>
    </div>
    <div class="page-wrapper" tabindex="-1" role="main">
        <div class="page-inner">
            <div id="book-search-results">
                <div class="search-noresults">
                    <section class="normal markdown-section">
                        <h1 id="rust-style-guide">Rust Style Guide</h1>

<p>Like many style guides, this Rust style guide exists for two primary reasons.
The first is to provide guidelines that result in a consistent code style across
all of the Enso codebases, while the second is to guide people towards a style
that is expressive while still easy to read and understand.</p>

<p>In general, it aims to create a set of ‘zero-thought’ rules in order to ease the
programmer burden; there is usually only <em>one way</em> to lay out code correctly.</p>

<!-- MarkdownTOC levels="2,3" autolink="true" -->

<ul>
  <li><a href="#code-formatting">Code Formatting</a>
    <ul>
      <li><a href="#line-width">Line Width</a></li>
      <li><a href="#imports">Imports</a></li>
      <li><a href="#sections">Sections</a></li>
      <li><a href="#vertical-spacing">Vertical Spacing</a></li>
      <li><a href="#multi-line-expressions">Multi-Line Expressions</a></li>
      <li><a href="#vertical-alignment">Vertical Alignment</a></li>
      <li><a href="#spacing">Spacing</a></li>
      <li><a href="#impl-definitions">Impl Definitions</a></li>
      <li><a href="#getters-and-setters">Getters and Setters</a></li>
      <li><a href="#trait-exports">Trait Exports</a></li>
    </ul>
  </li>
  <li><a href="#naming">Naming</a></li>
  <li><a href="#package-structure-and-naming">Package Structure and Naming</a>
    <ul>
      <li><a href="#the-public-api">The Public API</a></li>
    </ul>
  </li>
  <li><a href="#build-tooling">Build Tooling</a></li>
  <li><a href="#commenting">Commenting</a>
    <ul>
      <li><a href="#documentation-comments">Documentation Comments</a></li>
      <li><a href="#source-notes">Source Notes</a></li>
      <li><a href="#todo-comments">TODO Comments</a></li>
      <li><a href="#other-comment-usage">Other Comment Usage</a></li>
    </ul>
  </li>
  <li><a href="#program-design">Program Design</a>
    <ul>
      <li><a href="#code-complexity">Code Complexity</a></li>
      <li><a href="#safety">Safety</a></li>
      <li><a href="#testing-and-benchmarking">Testing and Benchmarking</a></li>
      <li><a href="#warnings-and-lints">Warnings, and Lints</a></li>
    </ul>
  </li>
</ul>

<!-- /MarkdownTOC -->

<h2 id="code-formatting">Code Formatting</h2>

<p>This section explains the rules for visually laying out your code. They provide
a robust set of guidelines for creating a consistent visual to the code.</p>

<p>Code style is <em>far</em> more than just the visual formatting of the code, especially
as formatting can often be automated. According to the documentation of rustfmt,
“formatting code is a mostly mechanical task which takes both time and mental
effort.” While, in many cases, the programmer can be relieved of this burden
through use of an automated formatter, it is sometimes the case that such a tool
imposes <em>more</em> cognitive load in programmers. With rustfmt, programmers tend to
have to refactor long lines to use variables, and move code to specific modules
or sections lest rustfmt produce code that is hard to read and write. Thus, it
is very important to write code in such a way that we can be proud of its
quality.</p>

<p>Due to the fact that <code class="language-plaintext highlighter-rouge">rustfmt</code> doesn’t support multiple of our requirements, we
have created a guide for how to format Rust code for this project. Please read
it carefully.</p>

<p>We hope that, in the future, <code class="language-plaintext highlighter-rouge">rustfmt</code> will come to support many of the things
described below, but even so, many portions of this guide will need to be
handled manually.</p>

<h3 id="line-width">Line Width</h3>

<p>Each line in the source file should be of a maximum of 100 characters of text.
This includes comments.</p>

<h3 id="imports">Imports</h3>

<p>The imports section at the top of a file should be separated into four groups.
These groups should be sorted in alphabetical order and are divided as follows:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Group 1: sub-module definitions.</span>
<span class="c">// Group 2: prelude-like imports.</span>
<span class="c">// Group 3: local-crate imports.</span>
<span class="c">// Group 4: external imports.</span>
</code></pre></div></div>

<p>Please look at the following by way of example:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">mod</span> <span class="n">display_object</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="n">closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="nn">data</span><span class="p">::</span><span class="nn">opt_vec</span><span class="p">::</span><span class="n">OptVec</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="n">dirty</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="nn">system</span><span class="p">::</span><span class="nn">web</span><span class="p">::</span><span class="n">group</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">nalgebra</span><span class="p">::</span><span class="n">Matrix4</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">nalgebra</span><span class="p">::</span><span class="n">Vector3</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="sections">Sections</h3>

<p>Rust source files should be divided into sections, with a header placed before
the definition of each new concept in a file.</p>

<p>By the term “concept,” we are referring primarily to a structure with a set of
related implementations. However if the related implementations rely on some
simple helper structs, these may also be defined in the same section. A section
should have a header as follows.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// ===================</span>
<span class="c">// === SectionName ===</span>
<span class="c">// ===================</span>
</code></pre></div></div>

<p>Additionally, the code in each section should further be divided into
sub-sections that group relevant functionality within the section. The header
for a sub-section is as follows.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// === SubSectionName ===</span>
</code></pre></div></div>

<p>At least one section should be defined in every file.</p>

<h4 id="an-example-of-using-sections">An Example of Using Sections</h4>

<p>Here is a large-scale example of how sections should be used in source files.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// =================</span>
<span class="c">// === AxisOrder ===</span>
<span class="c">// =================</span>

<span class="c">/// Defines the order in which particular axis coordinates are processed. Used</span>
<span class="c">/// for example to define the rotation order in `DisplayObject`.</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">AxisOrder</span> <span class="p">{</span><span class="n">XYZ</span><span class="p">,</span><span class="n">XZY</span><span class="p">,</span><span class="n">YXZ</span><span class="p">,</span><span class="n">YZX</span><span class="p">,</span><span class="n">ZXY</span><span class="p">,</span><span class="n">ZYX</span><span class="p">}</span>

<span class="k">impl</span> <span class="n">Default</span> <span class="k">for</span> <span class="n">AxisOrder</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">default</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span><span class="nn">Self</span><span class="p">::</span><span class="n">XYZ</span><span class="p">}</span>
<span class="p">}</span>



<span class="c">// =================</span>
<span class="c">// === Transform ===</span>
<span class="c">// =================</span>

<span class="c">/// Defines the order in which transformations (scale, rotate, translate) are</span>
<span class="c">/// applied to a particular object.</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">TransformOrder</span> <span class="p">{</span>
    <span class="n">ScaleRotateTranslate</span><span class="p">,</span>
    <span class="n">ScaleTranslateRotate</span><span class="p">,</span>
    <span class="n">RotateScaleTranslate</span><span class="p">,</span>
    <span class="n">RotateTranslateScale</span><span class="p">,</span>
    <span class="n">TranslateRotateScale</span><span class="p">,</span>
    <span class="n">TranslateScaleRotate</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Default</span> <span class="k">for</span> <span class="n">TransformOrder</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">default</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span> <span class="nn">Self</span><span class="p">::</span><span class="n">ScaleRotateTranslate</span> <span class="p">}</span>
<span class="p">}</span>



<span class="c">// =============================</span>
<span class="c">// === HierarchicalTransform ===</span>
<span class="c">// =============================</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">HierarchicalTransform</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">transform</span>        <span class="p">:</span> <span class="n">Transform</span><span class="p">,</span>
    <span class="n">transform_matrix</span> <span class="p">:</span> <span class="n">Matrix4</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">origin</span>           <span class="p">:</span> <span class="n">Matrix4</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">matrix</span>           <span class="p">:</span> <span class="n">Matrix4</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">dirty</span>        <span class="p">:</span> <span class="nn">dirty</span><span class="p">::</span><span class="n">SharedBool</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">logger</span>       <span class="p">:</span> <span class="n">Logger</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span> <span class="n">HierarchicalTransform</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">logger</span><span class="p">:</span><span class="n">Logger</span><span class="p">,</span> <span class="n">on_change</span><span class="p">:</span><span class="n">OnChange</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">logger_dirty</span>     <span class="o">=</span> <span class="n">logger</span><span class="nf">.sub</span><span class="p">(</span><span class="s">"dirty"</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">transform</span>        <span class="o">=</span> <span class="nf">default</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">transform_matrix</span> <span class="o">=</span> <span class="nn">Matrix4</span><span class="p">::</span><span class="nf">identity</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">origin</span>           <span class="o">=</span> <span class="nn">Matrix4</span><span class="p">::</span><span class="nf">identity</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">matrix</span>           <span class="o">=</span> <span class="nn">Matrix4</span><span class="p">::</span><span class="nf">identity</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">dirty</span>            <span class="o">=</span> <span class="nn">dirty</span><span class="p">::</span><span class="nn">SharedBool</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">logger_dirty</span><span class="p">,</span><span class="n">on_change</span><span class="p">);</span>
        <span class="n">Self</span> <span class="p">{</span><span class="n">transform</span><span class="p">,</span><span class="n">transform_matrix</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">matrix</span><span class="p">,</span><span class="n">dirty</span><span class="p">,</span><span class="n">logger</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c">// === Getters ===</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span> <span class="n">HierarchicalTransform</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">position</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="k">self</span><span class="py">.transform.position</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">rotation</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="k">self</span><span class="py">.transform.rotation</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>


<span class="c">// === Setters ===</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="p">:</span><span class="n">Callback0</span><span class="o">&gt;</span> <span class="n">HierarchicalTransform</span><span class="o">&lt;</span><span class="n">OnChange</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">position_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.dirty</span><span class="nf">.set</span><span class="p">();</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.transform.position</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">rotation_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f32</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.dirty</span><span class="nf">.set</span><span class="p">();</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.transform.rotation</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="vertical-spacing">Vertical Spacing</h3>

<p>We use the following rules for the amount of vertical space separating various
constructs in the source:</p>

<ul>
  <li>3 blank lines after imports.</li>
  <li>3 blank lines before each section.</li>
  <li>2 blank lines before each sub-section.</li>
  <li>1 blank line after each section / sub-section.</li>
  <li>1 blank line before functions / structures / impls.</li>
  <li>1 blank line at the end of the file.</li>
</ul>

<p>Please note that the spacing ‘overlaps’, in that if multiple rules, you should
take the maximum of the spacings that apply. For example, if you have a section
following the imports, you only use three lines of spacing.</p>

<h3 id="multi-line-expressions">Multi-Line Expressions</h3>

<p>In an ideal world, all expressions in the code should be a single line. This is
because multi-line expressions are usually hard to read, and because they can
introduce lots of noise in the code. In the vast majority of cases, the presence
of a multi-line expression indicates that the code needs refactoring.</p>

<p>Please try to refactor portions of multi-line expressions to well-named
variables, and divide them up to a set of single-line expressions.</p>

<h4 id="multi-line-expression-examples">Multi-Line Expression Examples</h4>

<p>The following is an example of poorly formatted code:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">shape_dirty</span> <span class="o">=</span> <span class="nn">ShapeDirty</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">logger</span><span class="nf">.sub</span><span class="p">(</span><span class="s">"shape_dirty"</span><span class="p">),</span>
        <span class="n">on_dirty</span><span class="nf">.clone</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">dirty_flag</span> <span class="o">=</span> <span class="nn">MeshRegistryDirty</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">logger</span><span class="nf">.sub</span><span class="p">(</span><span class="s">"mesh_registry_dirty"</span><span class="p">),</span>
        <span class="n">on_dirty</span><span class="p">);</span>
    <span class="n">Self</span> <span class="p">{</span> <span class="n">dirty_flag</span><span class="p">,</span> <span class="n">dirty_flag</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The following is an example of the same code properly formatted:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">sub_logger</span>  <span class="o">=</span> <span class="n">logger</span><span class="nf">.sub</span><span class="p">(</span><span class="s">"shape_dirty"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">shape_dirty</span> <span class="o">=</span> <span class="nn">ShapeDirty</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">sub_logger</span><span class="p">,</span><span class="n">on_dirty</span><span class="nf">.clone</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">sub_logger</span>  <span class="o">=</span> <span class="n">logger</span><span class="nf">.sub</span><span class="p">(</span><span class="s">"mesh_registry_dirty"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">dirty_flag</span>  <span class="o">=</span> <span class="nn">MeshRegistryDirty</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">sub_logger</span><span class="p">,</span><span class="n">on_dirty</span><span class="p">);</span>
    <span class="n">Self</span> <span class="p">{</span><span class="n">shape_dirty</span><span class="p">,</span><span class="n">dirty_flag</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="vertical-alignment">Vertical Alignment</h3>

<p>In order to create a visual flow to our code that aids readability, the
following constructs should be aligned vertically where possible:</p>

<ul>
  <li>Assignment operators (<code class="language-plaintext highlighter-rouge">=</code>)</li>
  <li>Type operators (<code class="language-plaintext highlighter-rouge">:</code>)</li>
  <li>Match arrows (<code class="language-plaintext highlighter-rouge">=&gt;</code>)</li>
  <li>Similar parameters or types</li>
</ul>

<h4 id="a-vertical-alignment-example">A Vertical Alignment Example</h4>

<p>The following is an example of a function that correctly uses the vertical
alignment rules above:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">impl</span> <span class="n">Printer</span> <span class="k">for</span> <span class="n">GlobalVarStorage</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">Builder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">match</span> <span class="k">self</span> <span class="p">{</span>
            <span class="nn">Self</span><span class="p">::</span><span class="n">ConstStorage</span>      <span class="k">=&gt;</span> <span class="nd">build!</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="s">"const"</span><span class="p">),</span>
            <span class="nn">Self</span><span class="p">::</span><span class="n">UniformStorage</span>    <span class="k">=&gt;</span> <span class="nd">build!</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="s">"uniform"</span><span class="p">),</span>
            <span class="nn">Self</span><span class="p">::</span><span class="nf">InStorage</span>  <span class="p">(</span><span class="n">qual</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">build!</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="s">"in"</span> <span class="p">,</span><span class="n">qual</span><span class="p">),</span>
            <span class="nn">Self</span><span class="p">::</span><span class="nf">OutStorage</span> <span class="p">(</span><span class="n">qual</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">build!</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="s">"out"</span><span class="p">,</span><span class="n">qual</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="spacing">Spacing</h3>

<p>The following spacing rules are <em>also</em> employed in order to create a visual flow
to our code to aid readability:</p>

<ul>
  <li>The type operator is not spaced: <code class="language-plaintext highlighter-rouge">fn test(foo:String, bar:Int) { ... }</code></li>
  <li>Commas between complex expressions (including the argument list) are spaced</li>
  <li>Commas between simple elements are not spaced: <code class="language-plaintext highlighter-rouge">Result&lt;Self,Error&gt;</code></li>
  <li>Arguments to functions are not spaced: <code class="language-plaintext highlighter-rouge">build(builder,"out",qual)</code></li>
  <li>Operators are always spaced: <code class="language-plaintext highlighter-rouge">let foo = a + b * c;</code></li>
</ul>

<h4 id="spacing-examples-as-function-definitions">Spacing Examples as Function Definitions</h4>

<p>The following function definitions are all good examples of correct use of
spacing.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">Dom</span><span class="p">:</span><span class="n">Str</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dom</span><span class="p">:</span><span class="n">Dom</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">Logger</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">Dom</span><span class="p">:</span><span class="n">Str</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dom</span><span class="p">:</span><span class="n">Dom</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">Logger</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">Dom</span><span class="p">:</span><span class="n">Str</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">dom</span><span class="p">:</span><span class="n">Dom</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">Logger</span><span class="p">,</span> <span class="n">on_dirty</span><span class="p">:</span><span class="n">OnDirty</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">Dom</span><span class="p">:</span><span class="n">Str</span><span class="o">&gt;</span>
<span class="p">(</span><span class="n">dom</span><span class="p">:</span><span class="n">Dom</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">Logger</span><span class="p">,</span> <span class="n">on_dirty</span><span class="p">:</span><span class="n">OnDirty</span><span class="p">,</span> <span class="n">on_remove</span><span class="p">:</span><span class="n">OnRemove</span><span class="p">)</span>
<span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">Dom</span><span class="p">:</span><span class="n">Str</span><span class="o">&gt;</span>
<span class="p">(</span> <span class="n">dom</span>        <span class="p">:</span> <span class="n">Dom</span>
<span class="p">,</span> <span class="n">logger</span>     <span class="p">:</span> <span class="n">Logger</span>
<span class="p">,</span> <span class="n">on_dirty</span>   <span class="p">:</span> <span class="n">OnDirty</span>
<span class="p">,</span> <span class="n">on_remove</span>  <span class="p">:</span> <span class="n">OnRemove</span>
<span class="p">,</span> <span class="n">on_replace</span> <span class="p">:</span> <span class="n">OnReplace</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Long <code class="language-plaintext highlighter-rouge">where</code> clauses are formatted like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="n">L</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dom</span><span class="p">:</span><span class="n">D</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">L</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span>
<span class="k">where</span> <span class="n">D</span><span class="p">:</span><span class="n">AsRef</span><span class="o">&lt;</span><span class="nb">str</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">L</span><span class="p">:</span><span class="n">IsLogger</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Or, in case they are really long, like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="n">new</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="n">L</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dom</span><span class="p">:</span><span class="n">D</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">L</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="n">Error</span><span class="o">&gt;</span>
<span class="k">where</span> <span class="n">D</span><span class="p">:</span><span class="n">AsRef</span><span class="o">&lt;</span><span class="nb">str</span><span class="o">&gt;</span>
      <span class="n">L</span><span class="p">:</span><span class="n">IsLogger</span>
      <span class="o">...</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="impl-definitions">Impl Definitions</h3>

<p>In order to aid in fast discovery of the header of an impl definition, we use
the following style. In all cases, the <code class="language-plaintext highlighter-rouge">where</code> block should be placed after a
line break.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// No constraints</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Printer</span> <span class="k">for</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Some constraints</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="n">Printer</span><span class="o">&gt;</span>
<span class="n">Printer</span> <span class="k">for</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Constraints in where block</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Printer</span> <span class="k">for</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="k">where</span> <span class="n">T</span><span class="p">:</span> <span class="n">Printer</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We also have a specific <em>ordering</em> for <code class="language-plaintext highlighter-rouge">impl</code> definitions. It is as follows:</p>

<ol>
  <li>The “main” <code class="language-plaintext highlighter-rouge">impl</code> for a type, containing its associated behaviour.</li>
  <li>Getter implementations, if present.</li>
  <li>Setter implementations, if present.</li>
  <li>Trait implementations for the type, if present.</li>
  <li>The “internal” <code class="language-plaintext highlighter-rouge">impl</code> block for that type, if present.</li>
</ol>

<p>Each of these should be accompanied by a sub-heading.</p>

<h3 id="getters-and-setters">Getters and Setters</h3>

<p>We have the following rules for getters and setters in our codebase.</p>

<ul>
  <li>Getters do not have the <code class="language-plaintext highlighter-rouge">get_</code> prefix, while setters do have the <code class="language-plaintext highlighter-rouge">set_</code>
prefix.</li>
  <li>If a setter is provided, a <code class="language-plaintext highlighter-rouge">mut</code> accessor should be provided as well as part
of the setters <code class="language-plaintext highlighter-rouge">impl</code> block.</li>
</ul>

<p>Correct examples for the definition of getters and setters can be found below:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">field</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="n">Type</span> <span class="p">{</span>
    <span class="o">&amp;</span><span class="k">self</span><span class="py">.field</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">field_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Type</span> <span class="p">{</span>
    <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.field</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">set_field</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span><span class="n">Type</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="k">self</span><span class="py">.field_mut</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Getters and setters should be implemented in separate <code class="language-plaintext highlighter-rouge">impl</code>, blocks, each with
their own subheading.</p>

<h3 id="trait-exports">Trait Exports</h3>

<p>All names should be designed to be used in a qualified fashion. This does,
however, make one situation quite tricky. In order to use methods defined inside
a trait, that trait has to be in scope.</p>

<p>Consider a trait <code class="language-plaintext highlighter-rouge">display::Object</code>. We want to use it in a function definition
like the following <code class="language-plaintext highlighter-rouge">fn test&lt;T:display::Object&gt;(t:T) { ... }</code>, and we also want
the ability to use methods defined in the trait (and hence it has to be in
scope). Under these circumstances, <code class="language-plaintext highlighter-rouge">clippy</code> warns that <code class="language-plaintext highlighter-rouge">display::Object</code> is
being subject to unnecessary qualification, but we don’t want to perform the
replacement.</p>

<p>In order to export traits, please rename them using the following convention:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// Common traits.</span>
<span class="k">pub</span> <span class="k">mod</span> <span class="n">traits</span> <span class="p">{</span>
    <span class="c">// Read the Rust Style Guide to learn more about the used naming.</span>
    <span class="k">pub</span> <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="n">Object</span>    <span class="k">as</span> <span class="n">TRAIT_Object</span><span class="p">;</span>
    <span class="k">pub</span> <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="n">ObjectOps</span> <span class="k">as</span> <span class="n">TRAIT_ObjectOps</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Once we have such a definition, we can import traits into scope using the simple
<code class="language-plaintext highlighter-rouge">use display::object::traits::*</code>, which will avoid any warnings about
unnecessary qualification.</p>

<h2 id="naming">Naming</h2>

<p>Enso has some fairly simple general naming conventions, though the sections
below may provide more rules for use in specific cases.</p>

<ul>
  <li>Types are written using <code class="language-plaintext highlighter-rouge">UpperCamelCase</code>.</li>
  <li>Variables and function names are written using <code class="language-plaintext highlighter-rouge">snake_case</code>.</li>
  <li>If a name contains an initialism or acronym, all parts of that initialism
should be lower-case: <code class="language-plaintext highlighter-rouge">make_http_request</code>, not <code class="language-plaintext highlighter-rouge">make_HTTP_request</code>.</li>
  <li>Short variable names such as <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> should only be used in the following
contexts:
    <ul>
      <li>Where there is no other appropriate name.</li>
      <li>Named lifetimes. They should <em>never</em> be used to refer to temporary data in a
function, as all temporaries should be given descriptive names.</li>
    </ul>
  </li>
  <li>Names should be descriptive, even if this makes them longer.</li>
  <li>Any function that performs an unsafe operation that is not documented in its
type (e.g. <code class="language-plaintext highlighter-rouge">fn head&lt;T&gt;(ts: Vec&lt;T&gt;) -&gt; T</code>, which fails if the list is empty),
must be named using the word ‘unsafe’ (e.g. <code class="language-plaintext highlighter-rouge">unsafeHead</code>). For more
information on unsafe function usage, see the section on <a href="#safety">safety</a>.</li>
  <li>Naming should use American English spelling.</li>
</ul>

<h2 id="package-structure-and-naming">Package Structure and Naming</h2>

<p>Enso follows the standard rust convention for structuring crates, as provided by
<code class="language-plaintext highlighter-rouge">cargo new</code>. This is discussed more in depth
<a href="https://learning-rust.github.io/docs/a4.cargo,crates_and_basic_project_structure.html#Project-Structure">here</a>.</p>

<h3 id="the-public-api">The Public API</h3>

<p>Whereas Rust defaults to making module members <em>private</em> by default, this is not
the philosophy used by the Enso codebases. We tend to want our codebase to be
flexible for consumers, so we tend to avoid making things private. Instead, we
use the concept of an <code class="language-plaintext highlighter-rouge">internal</code> module to separate public from private.</p>

<p>If you are writing code in a module <code class="language-plaintext highlighter-rouge">foo.bar.baz</code> and would like to signal that
a particular construct (e.g. a function) is for internal use in that package,
you should create a <code class="language-plaintext highlighter-rouge">foo.bar.baz.internal</code> package. You can then write the
relevant language construct in that package instead of the source package.</p>

<h4 id="using-access-modifiers">Using Access Modifiers</h4>

<p>Given Rust’s performance guarantees, making things <code class="language-plaintext highlighter-rouge">pub</code> has no impact on the
performance of the compiled code. As a result, the <em>only</em> circumstance under
which things are allowed to not be <code class="language-plaintext highlighter-rouge">pub</code> is when doing so would allow consumers
of an API to break internal guarantees provided by that API (e.g. building an
immutable collection on top of a mutable buffer).</p>

<h2 id="build-tooling">Build Tooling</h2>

<p>All Rust projects are built and managed using
<a href="https://doc.rust-lang.org/cargo/">cargo</a>.</p>

<h2 id="commenting">Commenting</h2>

<p>Comments in code are a tricky area to get right as we have found that comments
often expire quickly, and in absence of a way to validate them, remain incorrect
for long periods of time. In order to best deal with this problem, we make the
keeping of comments up-to-date into an integral part of our programming practice
while also limiting the types and kinds of comments we allow.</p>

<p>Comments across the Enso codebases fall into three main types:</p>

<ul>
  <li><strong>Documentation Comments:</strong> API documentation for all appropriate language
constructs.</li>
  <li><strong>Source Notes:</strong> Detailed explorations of design reasoning that avoid
cluttering the code itself.</li>
  <li><strong>Tasks:</strong> Things that need doing or fixing in the codebase.</li>
</ul>

<p>When we write comments, we try to follow one general guideline. A comment should
explain <em>what</em> and <em>why</em>, without mentioning <em>how</em>. The <em>how</em> should be
self-explanatory from reading the code, and if you find that it is not, that is
a sign that the code in question needs refactoring.</p>

<p>Code should be written in such a way that it guides you over what it does, and
comments should not be used as a crutch for badly-designed code.</p>

<h3 id="documentation-comments">Documentation Comments</h3>

<p>One of the primary forms of comment that we allow across the Enso codebases is
the doc comment. We use these comments to document the public API of a module,
as defined in <a href="#the-public-api">The Public API</a>. For constructs that <em>are</em> part
of the public API, the following should be documented:</p>

<ol>
  <li><strong>Top-Level Type Definitions:</strong> All top-level type definitions must have a
doc comment.</li>
  <li><strong>Functions:</strong> Function documentation should provide at-a-glance intuition
for how to use that function.</li>
</ol>

<p>Documentation comments are intended for consumption by the users of the API, and
are written using the standard
<a href="https://doc.rust-lang.org/rustdoc/index.html">rustdoc</a> syntax. Doc comments
should contain:</p>

<ol>
  <li><strong>Summary:</strong> A one-line summary of the construct’s behaviour or purpose.</li>
  <li><strong>Description (Optional):</strong> Any useful information that would be necessary
for a consumer of the API to know (that is not encoded in the types). This
should be written in grammatically correct English.</li>
</ol>

<p>Convention in rust is to not document function or return parameters, and so
rustdoc does not provide a way to do so.</p>

<p>An example of a valid set of comments for some rust code is as follows:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// A representation of tree structures containing elements of type `T`.</span>
<span class="k">pub</span> <span class="k">trait</span> <span class="n">Tree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c">/// Provides a sequence representation of the tree.</span>
  <span class="c">///</span>
  <span class="c">/// The function provides configurable behaviour for the order in which the</span>
  <span class="c">/// tree is walked. See [WalkStrategy](org.enso.WalkStrategy.html) for</span>
  <span class="c">/// the provided options.</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">walk_to_sequence</span><span class="p">(</span><span class="k">self</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">WalkStrategy</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// ...</span>
  <span class="p">}</span>

  <span class="k">fn</span> <span class="nf">getBuffer</span><span class="p">(</span><span class="k">self</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Documentation comments should not reference internal implementation details, or
be used to explain choices made in the implementation. For this kind of info,
you should use <a href="#source-notes">Source Notes</a> as described below.</p>

<p>You may document <em>more</em> than what is specified here, but this is the <em>minimum</em>
required for acceptance at code-review time.</p>

<h3 id="source-notes">Source Notes</h3>

<p>Source Notes is a mechanism for moving detailed design information about a piece
of code out of the code itself. In doing so, it retains the key information
about the design while not impeding the flow of the code. They are used in the
following circumstances:</p>

<ul>
  <li><strong>Design Information:</strong> Documentation about <em>why</em> something was written in a
particular fashion, as well as information on the process that led to it being
done this way.</li>
  <li><strong>Explaining Complexity:</strong> If an implementation uses complex constructs or any
elements that are non-obvious, these should be explained as part of a source
note.</li>
  <li><strong>Knowledge Provenance:</strong> Explaining where some knowledge (e.g. a mathematical
formula or an algorithm) was obtained from. It is also useful to accompany
these by some commentary on <em>why</em> the choice was made.</li>
  <li><strong>Safety:</strong> Any unsafe usage of a function must be accompanied by a source
note that explains what makes this particular usage safe.</li>
</ul>

<p>Source notes are detailed comments that, like all comments, explain both the
<em>what</em> and the <em>why</em> of the code being described. In very rare cases, it may
include some <em>how</em>, but only to refer to why a particular method was chosen to
achieve the goals in question.</p>

<p>A source note comment is broken into two parts:</p>

<ol>
  <li><strong>Referrer:</strong> This is a small comment left at the point where the explanation
is relevant. It takes the following form: <code class="language-plaintext highlighter-rouge">// Note [Note Name]</code>, where
<code class="language-plaintext highlighter-rouge">Note Name</code> is a unique identifier across the codebase. These names should be
descriptive, and make sure you search for it before using it, in case it is
already in use.</li>
  <li><strong>Source Note:</strong> This is the comment itself, which is a large block comment
placed after the first function in which it is referred to in the module. The
first line names the note using the same referrer as above:
<code class="language-plaintext highlighter-rouge">// Note [Note Name]</code>. The name(s) in the note are underlined using a string
of the <code class="language-plaintext highlighter-rouge">=</code> (equals) character.</li>
</ol>

<p>A source note may contain sections within it where necessary. These are titled
using the following syntax: <code class="language-plaintext highlighter-rouge">== Note [Note Name (Section Name)]</code>, and can be
referred to from a referrer much as the main source note can be.</p>

<p>Sometimes it is necessary to reference a source note in another module, but this
should never be done in-line. Instead, a piece of code should reference a source
note in the same module that references the other note while providing
additional context to that reference.</p>

<p>An example can be seen below:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// A representation of tree structures containing elements of type `T`.</span>
<span class="k">pub</span> <span class="k">trait</span> <span class="n">Tree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c">/// Provides a sequence representation of the tree.</span>
  <span class="c">///</span>
  <span class="c">/// The function provides configurable behaviour for the order in which the</span>
  <span class="c">/// tree is walked. See [WalkStrategy](org.enso.WalkStrategy.html) for</span>
  <span class="c">/// the provided options.</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">walk_to_sequence</span><span class="p">(</span><span class="k">self</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">WalkStrategy</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">output_vec</span> <span class="o">=</span> <span class="nb">Vec</span><span class="nf">.new</span><span class="p">(</span><span class="k">self</span><span class="nf">.getBuffer</span><span class="p">()</span><span class="nf">.len</span><span class="p">());</span> <span class="c">// Note [Buffer Size]</span>
    <span class="c">// ...</span>
  <span class="p">}</span>

  <span class="c">// Note [Buffer Size]</span>
  <span class="c">// ==================</span>
  <span class="c">// When working with the buffer for the tree walk, it is important that you</span>
  <span class="c">// ensure....</span>

  <span class="k">fn</span> <span class="nf">getBuffer</span><span class="p">(</span><span class="k">self</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="todo-comments">TODO Comments</h3>

<p>We follow a simple convention for <code class="language-plaintext highlighter-rouge">TODO</code> comments in our codebases:</p>

<ul>
  <li>The line starts with <code class="language-plaintext highlighter-rouge">TODO</code> or <code class="language-plaintext highlighter-rouge">FIXME</code>.</li>
  <li>It is then followed by the author’s initials <code class="language-plaintext highlighter-rouge">[ARA]</code>, or for multiple people
<code class="language-plaintext highlighter-rouge">[ARA, MK]</code>, in square brackets.</li>
  <li>It is then followed by an explanation of what needs to be done.</li>
</ul>

<p>For example:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// TODO [ARA] This is a bit of a kludge. Instead of X it should to Y, accounting</span>
<span class="c">// for the fact that Z.</span>
</code></pre></div></div>

<h3 id="other-comment-usage">Other Comment Usage</h3>

<p>There are, of course, a few other situations where commenting is very useful:</p>

<ul>
  <li><strong>Commenting Out:</strong> You may comment out code while developing it, but if you
commit any commented out code, it should be accompanied by an explanation of
why said code can’t just be deleted.</li>
  <li><strong>Bugs:</strong> You can use comments to indicate bugs in our code, as well as
third-party bugs. In both cases, the comment should link to the issue tracker
where the bug has been reported.</li>
</ul>

<h2 id="program-design">Program Design</h2>

<p>Any good style guide goes beyond purely stylistic rules, and also talks about
design styles to use in code.</p>

<h3 id="code-complexity">Code Complexity</h3>

<p>While we often have to write complex functionality, we want to ensure that the
code itself is kept as simple and easy to read as possible. To do this, please
use the following rules:</p>

<ul>
  <li>Write single-line expressions wherever possible, rather than writing one
complex chunk of code.</li>
  <li>Separate intermediate results out to their own variables with appropriate
names. Even if they are temporaries, giving them a name is a great aid to code
comprehension.</li>
</ul>

<h3 id="safety">Safety</h3>

<p>Whereas most languages don’t have a concept of <em>safety</em>, rust comes with a built
in notion of <code class="language-plaintext highlighter-rouge">unsafe</code>. When working with <code class="language-plaintext highlighter-rouge">unsafe</code> functions and code blocks, you
must account for the following:</p>

<ul>
  <li>As unsafe functions are explicitly declared with the keyword <code class="language-plaintext highlighter-rouge">unsafe</code>, we do
not need any special naming convention for them.</li>
  <li>Usage of unsafety should be confined to the smallest possible block.</li>
  <li>Usage of unsafety should be accompanied by a source note that explains why it
is necessary, and any constraints on its usage.</li>
  <li>Unsafe function usage must be accompanied by a source note explaining how this
usage of it is made safe.</li>
</ul>

<p>Furthermore, we do not allow for code containing pattern matches that can fail.</p>

<h3 id="testing-and-benchmarking">Testing and Benchmarking</h3>

<p>New code should always be accompanied by tests. These can be unit, integration,
or some combination of the two, and they should always aim to test the new code
in a rigorous fashion.</p>

<ul>
  <li>Testing should be performed as described in
<a href="https://doc.rust-lang.org/book/ch11-00-testing.html">the Rust book</a> and
should use the functionality for testing built into the language.</li>
  <li>Tests should cover as much code as possible, and may be a combination of unit
and integration tests.</li>
</ul>

<p>Any performance-critical code should also be accompanied by a set of benchmarks.
These are intended to allow us to catch performance regressions as the code
evolves, but also ensure that we have some idea of the code’s performance in
general.</p>

<ul>
  <li>We use nightly rust in order to access the built-in
<a href="https://doc.rust-lang.org/unstable-book/library-features/test.html">benchmarking</a>
functionality.</li>
  <li>We measure time, CPU, and memory usage where possible.</li>
  <li>Where relevant, benchmarks may set thresholds which, when surpassed, cause the
benchmark to fail. These thresholds should be set for a release build, and not
for a development build.</li>
</ul>

<p><em>Do not benchmark a development build</em> as the data you get will often be
entirely useless.</p>

<h3 id="warnings-and-lints">Warnings, and Lints</h3>

<p>In general, we aim for a codebase that is free of warnings and lints, and we do
this using the following ideas:</p>

<h4 id="warnings">Warnings</h4>

<p>New code should introduce no new warnings onto main. You may build with warnings
on your own branch, but the code that is submitted as part of a PR should not
introduce new warnings. You should also endeavour to fix any warnings that you
come across during development.</p>

<p>Sometimes it is impossible to fix a warning (often in situations involving the
use of macros). In such cases, you are allowed to suppress the warning locally,
but this must be accompanied by a source note explaining why you are doing so.</p>

                        
                        

                    </section>
                </div>

                 <!--<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>-->
            </div>
        </div>
    </div>
</div>

                <a href="/docs/developer/enso/style-guide/java.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Java Style Guide">
                    <i class="fa fa-angle-left"></i>
                </a>
                

                
                    <a href="/docs/developer/enso/style-guide/haskell.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Haskell Style Guide">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},
            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper"],
                "facebook": true,
                "google": false,
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
            "theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Enso Developer Documentation",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "enso/style-guide/rust.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2021-07-26 12:27:58 +0000"
    },
    "basePath": "/docs/developer",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/docs/developer/gitbook/gitbook.js"></script>
<script src="/docs/developer/gitbook/theme.js"></script>

<script src="/docs/developer/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> --></body>
</html>