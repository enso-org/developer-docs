<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Managed Resources · Enso Developer Documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="The developer documentation for the Enso compiler, runtime, and IDE..
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Enso.org"><link rel="stylesheet" href="/docs/developer/gitbook/style.css">
<link rel="stylesheet" href="/docs/developer/gitbook/gitbook-plugin-fontsettings/website.css">
<!-- <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css"> -->

<link rel="stylesheet" href="/docs/developer/gitbook/rouge-highlight-colorful.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/docs/developer/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/docs/developer/gitbook/images/favicon.ico" type="image/x-icon">
        

        
        


        
        
        

        
        
        

        
            <link rel="prev" href="/docs/developer/enso/semantics/numbers.html" />
        

        
            <link rel="next" href="/docs/developer/enso/semantics/tail-call-optimization.html" />
        
    </head>
    <body>
        
        <div class="book"><div class="book-summary">
    <div id="search-searchbar">
    </div>
    <div class="post-list" id="search-hits">
        
      </div>
      <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>
    <nav role="navigation">
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/">
            
                <a href="/docs/developer/">
                    Home
                </a>
            </li>

            <li class="divider"></li>
            
            
            
            
            

            
            
        
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics ">
                    <a href="/docs/developer/enso/semantics">
                        Go back
                    </a>
                </li>
                <li class="divider"></li>
            
                
             
            
            
            
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/">
                    
                        <a href="/docs/developer/enso/semantics/">
                            
                                Enso&#39;s Semantics
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/bindings.html">
                    
                        <a href="/docs/developer/enso/semantics/bindings.html">
                            
                                Bindings
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/diagnostics.html">
                    
                        <a href="/docs/developer/enso/semantics/diagnostics.html">
                            
                                Diagnostics
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/dispatch.html">
                    
                        <a href="/docs/developer/enso/semantics/dispatch.html">
                            
                                Dispatch
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/errors.html">
                    
                        <a href="/docs/developer/enso/semantics/errors.html">
                            
                                Errors
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/evaluation.html">
                    
                        <a href="/docs/developer/enso/semantics/evaluation.html">
                            
                                Evaluation Semantics in Enso
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/modules.html">
                    
                        <a href="/docs/developer/enso/semantics/modules.html">
                            
                                Modules
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/scoping.html">
                    
                        <a href="/docs/developer/enso/semantics/scoping.html">
                            
                                Scoping Rules
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/numbers.html">
                    
                        <a href="/docs/developer/enso/semantics/numbers.html">
                            
                                Numbers
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter active" data-level="1.2" data-path="/docs/developer/enso/semantics/managed-resources.html">
                    
                        <a href="/docs/developer/enso/semantics/managed-resources.html">
                            
                                Managed Resources
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/semantics/tail-call-optimization.html">
                    
                        <a href="/docs/developer/enso/semantics/tail-call-optimization.html">
                            
                                Managed Resources
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            

            
        
        </ul>
    </nav>
</div>
<div class="book-body"><div class="body-inner">
    <div class="book-header" role="navigation">
        <!-- Title -->
        <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
                <a href="." >Managed Resources</a>
            
        </h1>
    </div>
    <div class="page-wrapper" tabindex="-1" role="main">
        <div class="page-inner">
            <div id="book-search-results">
                <div class="search-noresults">
                    <section class="normal markdown-section">
                        <h1 id="managed-resources">Managed Resources</h1>

<p>Enso is a language targeting an audience with possibly low programming skills
and aims to be as user-friendly as possible. Therefore, it is crucial to provide
some mechanisms to automatically clean up unclosed resources (such as file
handles, sockets, machine pointers, etc.). The Managed Resources system solves
this problem, by allowing library authors to attach garbage collection hooks to
certain objects, such that a clean up action can be performed as soon as the
runtime discovers the resource will never be used again. This document outlines
the behavior of this system, as well as important notes regarding its use.</p>

<!-- MarkdownTOC levels="2,3" autolink="true" -->

<ul>
  <li><a href="#basic-usage">Basic Usage</a></li>
  <li><a href="#semantics-and-guarantees">Semantics and Guarantees</a>
    <ul>
      <li><a href="#execution-guarantees">Execution Guarantess</a></li>
      <li><a href="#multiple-managed-resources-wrapping-the-same-underlying-resource">Multiple Managed Resources Wrapping The Same Underlying Resource</a></li>
      <li><a href="#thread-safety">Thread Safety</a></li>
    </ul>
  </li>
</ul>

<!-- /MarkdownTOC -->

<h2 id="basic-usage">Basic Usage</h2>

<p>A new managed resource is created by calling the
<code class="language-plaintext highlighter-rouge">Managed_Resource.register resource finalizer</code> method. The <code class="language-plaintext highlighter-rouge">resource</code> is the
object being finalized and <code class="language-plaintext highlighter-rouge">finalizer</code> is a one-argument function that will be
passed the <code class="language-plaintext highlighter-rouge">resource</code> upon finalization. this call returns an object wrapping
the original resource. The underlying resource will be finalized as soon as the
<em>returned wrapper</em> is garbage collected. It is therefore crucial to stop using
<code class="language-plaintext highlighter-rouge">resource</code> right after the call, as it may be finalized at any point after this
call.</p>

<blockquote>
  <h4 id="important">Important</h4>

  <p>Due to the limitations of current implementation of Enso, the <code class="language-plaintext highlighter-rouge">finalizer</code>
passed to <code class="language-plaintext highlighter-rouge">Managed_Resource.register</code> must not be a lambda. This is because
lambdas implicitly capture the whole lexical scope they are defined in, so in
<code class="language-plaintext highlighter-rouge">res = Managed_Resource.register object (o -&gt; o.close)</code>, the <code class="language-plaintext highlighter-rouge">finalizer</code>
closes over the value of <code class="language-plaintext highlighter-rouge">res</code>, preventing it from being garbage collected.
The same limitation concerns the underscore-lambda syntax, as <code class="language-plaintext highlighter-rouge">_.close</code> is
equivalent to <code class="language-plaintext highlighter-rouge">o -&gt; o.close</code>. The finalizer should be a (possibly curried)
call to a function defined outside of the lexical scope of the
<code class="language-plaintext highlighter-rouge">Managed_Resource.register</code> call.</p>
</blockquote>

<p>To perform operations on the underlying resource, use the
<code class="language-plaintext highlighter-rouge">Managed_Resource.with resource action</code> method, where <code class="language-plaintext highlighter-rouge">resource</code> is the object
returned from the call to <code class="language-plaintext highlighter-rouge">Managed_Resource.register</code>, and <code class="language-plaintext highlighter-rouge">action</code> is a
function taking the underlying object as its only argument. It is important that
the object passed to <code class="language-plaintext highlighter-rouge">action</code> is not stored and is not used past the return of
<code class="language-plaintext highlighter-rouge">action</code>. This means in particular that it is unsafe to give another thread a
reference to that object, if the thread remains alive past the return of
<code class="language-plaintext highlighter-rouge">action</code>. If such an operation is necessary, the other thread should call <code class="language-plaintext highlighter-rouge">with</code>
itself, using a reference to the original manged resource.</p>

<p>A managed resource can be closed manually, using
<code class="language-plaintext highlighter-rouge">Managed_Resource.close resource</code>. The underlying object is then finalized
immediately.</p>

<p>The finalization of a resource can be aborted using
<code class="language-plaintext highlighter-rouge">Managed_Resource.take resource</code>. This call will abort any automatic
finalization actions and return the original underlying object. The return value
is no longer managed by the runtime and must either be finalized manually or
wrapped in a new managed resource using a call to <code class="language-plaintext highlighter-rouge">Managed_Resource.register</code>.</p>

<h2 id="semantics-and-guarantees">Semantics and Guarantees</h2>

<p>This section outlines the runtime semantics and guarantees provided by the
managed resources system.</p>

<h3 id="execution-guarantees">Execution Guarantees</h3>

<p>The finalizer attached to a managed resource is guaranteed to be executed
at-most-once.</p>

<p>There are no guarantees that the finalizer will ever <em>be</em> executed. It is
executed as soon as the runtime garbage-collects the managed resource, but this
is not to say “as soon as the managed resource becomes unreachable”. The runtime
is free to run garbage collection at any point, including to not run it at all
over the course of program execution. A call to <code class="language-plaintext highlighter-rouge">Runtime.gc</code> serves as hint to
the runtime system to perform garbage collection, but does not guarantee that
garbage collection will actually run.</p>

<p>The finalizer may be run from any application thread, with no guarantees as to
which thread will perform the finalization.</p>

<h3 id="multiple-managed-resources-wrapping-the-same-underlying-resource">Multiple Managed Resources Wrapping The Same Underlying Resource</h3>

<p>In case the same underlying resource is used in multiple managed resources, it
will be finalized as soon as the first managed resource is garbage collected.
Moreover, the finalizer will be called for each garbage collected managed
resource, possibly leading to multiple-finalization of the underlying object.
Therefore, using the same underlying resource with multiple managed resource
instances should be considered an error.</p>

<h3 id="thread-safety">Thread Safety</h3>

<p>Operations on managed resources are thread safe. Therefore, the safety
guarantees of the underlying resources are the limitation – if the underlying
resource is not thread-safe, calls to <code class="language-plaintext highlighter-rouge">Managed_Resource.with</code> will also not be
thread-safe.</p>

                        
                        

                    </section>
                </div>

                 <!--<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>-->
            </div>
        </div>
    </div>
</div>

                <a href="/docs/developer/enso/semantics/numbers.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Numbers">
                    <i class="fa fa-angle-left"></i>
                </a>
                

                
                    <a href="/docs/developer/enso/semantics/tail-call-optimization.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Managed Resources">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},
            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper"],
                "facebook": true,
                "google": false,
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
            "theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Enso Developer Documentation",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "enso/semantics/managed-resources.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2021-08-11 13:40:41 +0000"
    },
    "basePath": "/docs/developer",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/docs/developer/gitbook/gitbook.js"></script>
<script src="/docs/developer/gitbook/theme.js"></script>

<script src="/docs/developer/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> --></body>
</html>