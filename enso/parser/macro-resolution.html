<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Macro Resolution · Enso Developer Documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="The developer documentation for the Enso compiler, runtime, and IDE..
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Enso.org"><link rel="stylesheet" href="/docs/developer/gitbook/style.css">
<link rel="stylesheet" href="/docs/developer/gitbook/gitbook-plugin-fontsettings/website.css">
<!-- <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css"> -->

<link rel="stylesheet" href="/docs/developer/gitbook/rouge-highlight-colorful.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/docs/developer/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/docs/developer/gitbook/images/favicon.ico" type="image/x-icon">
        

        
        


        
        
        

        
        
        

        
            <link rel="prev" href="/docs/developer/enso/parser/lexer.html" />
        

        
            <link rel="next" href="/docs/developer/enso/parser/operator-resolution.html" />
        
    </head>
    <body>
        
        <div class="book"><div class="book-summary">
    <div id="search-searchbar">
    </div>
    <div class="post-list" id="search-hits">
        
      </div>
      <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>
    <nav role="navigation">
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/">
            
                <a href="/docs/developer/">
                    Home
                </a>
            </li>

            <li class="divider"></li>
            
            
            
            
            

            
            
        
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser ">
                    <a href="/docs/developer/enso/parser">
                        Go back
                    </a>
                </li>
                <li class="divider"></li>
            
                
             
            
            
            
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/">
                    
                        <a href="/docs/developer/enso/parser/">
                            
                                Enso&#39;s Parser
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/tech-analysis.html">
                    
                        <a href="/docs/developer/enso/parser/tech-analysis.html">
                            
                                Technology Analysis
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/architecture.html">
                    
                        <a href="/docs/developer/enso/parser/architecture.html">
                            
                                Parser Architecture Overview
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/lexer.html">
                    
                        <a href="/docs/developer/enso/parser/lexer.html">
                            
                                Lexer
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter active" data-level="1.2" data-path="/docs/developer/enso/parser/macro-resolution.html">
                    
                        <a href="/docs/developer/enso/parser/macro-resolution.html">
                            
                                Macro Resolution
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/operator-resolution.html">
                    
                        <a href="/docs/developer/enso/parser/operator-resolution.html">
                            
                                Operator Resolution
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/construct-resolution.html">
                    
                        <a href="/docs/developer/enso/parser/construct-resolution.html">
                            
                                Construct Resolution
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/parser-driver.html">
                    
                        <a href="/docs/developer/enso/parser/parser-driver.html">
                            
                                Parser Driver
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/ast.html">
                    
                        <a href="/docs/developer/enso/parser/ast.html">
                            
                                AST
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/jvm-object-generation.html">
                    
                        <a href="/docs/developer/enso/parser/jvm-object-generation.html">
                            
                                JVM Object Generation
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/parser/reader.html">
                    
                        <a href="/docs/developer/enso/parser/reader.html">
                            
                                Reading Source Code
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            

            
        
        </ul>
    </nav>
</div>
<div class="book-body"><div class="body-inner">
    <div class="book-header" role="navigation">
        <!-- Title -->
        <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
                <a href="." >Macro Resolution</a>
            
        </h1>
    </div>
    <div class="page-wrapper" tabindex="-1" role="main">
        <div class="page-inner">
            <div id="book-search-results">
                <div class="search-noresults">
                    <section class="normal markdown-section">
                        <h1 id="macro-resolution">Macro Resolution</h1>

<p>The Enso macro system is responsible for translating the structured token stream
from the <a href="/docs/developer/enso/parser/lexer.html">lexer</a> and resolving it into the output <a href="/docs/developer/enso/parser/ast.html">ast</a>
that represents the Enso language.</p>

<p>The macro system is of <em>key</em> importance to the operation of Enso, providing the
IDE with detailed information on how users can interact with each and every
portion of the syntax. This has myriad benefits over a traditional parser,
allowing the IDE to handle all portions of the language’s syntax in a seamless
way; the <a href="#macro-matchers">macro matchers</a> describe the Enso syntax in a way
that allows the IDE to extract information about extension points and other
crucial metadata.</p>

<p>Nevertheless, the macro system <em>also</em> serves as the language’s parser,
implementing a sophisticated resolution algorithm that is able to turn the token
stream into the language AST.</p>

<p>Furthermore, the macro system can be extended in future to allow <em>users</em> to
define their own hygienic macros in Enso itself. This will allow them to
manipulate their programs syntactically using <em>exactly</em> the same mechanism as
used in the Enso parser itself.</p>

<!-- MarkdownTOC levels="2,3" autolink="true" indent="  " -->

<ul>
  <li><a href="#resolving-macros">Resolving Macros</a>
    <ul>
      <li><a href="#macro-segments">Macro Segments</a></li>
      <li><a href="#matching">Matching</a></li>
    </ul>
  </li>
  <li><a href="#macro-matchers">Macro Matchers</a>
    <ul>
      <li><a href="#relative-precedence-matchers">Relative Precedence Matchers</a></li>
      <li><a href="#named-macros">Named Macros</a></li>
    </ul>
  </li>
  <li><a href="#macro-resolution-errors">Macro Resolution Errors</a>
    <ul>
      <li><a href="#macro-errors-as-parser-errors">Macro Errors as Parser Errors</a></li>
    </ul>
  </li>
  <li><a href="#user-defined-macros">User-Defined Macros</a></li>
  <li><a href="#benchmarking">Benchmarking</a>
    <ul>
      <li><a href="#running-a-subset-of-the-benchmarks">Running a Subset of the Benchmarks</a></li>
      <li><a href="#changing-the-macro-resolver">Changing the Macro Resolver</a></li>
    </ul>
  </li>
</ul>

<!-- /MarkdownTOC -->

<h2 id="resolving-macros">Resolving Macros</h2>

<p>Conceptually, the macro resolution process builds a tree out of the user-defined
macros, segmenting the token-space based on the types of tokens expected by the
various definitions. Resolution then proceeds to walk the tree, pruning the
possible cases until either:</p>

<ol>
  <li>An unambiguous resolution is found.</li>
  <li>An ambiguous resolution is found and an error emitted.</li>
</ol>

<p>Resolution then recurses, continuing to apply the macro resolution process
against the non-matchable segments in the macro.</p>

<p>Consider, for example, the macros defined as follows:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">if_then</span>      <span class="o">=</span> <span class="s">"if"</span> <span class="o">&gt;&gt;</span> <span class="nn">Matcher</span><span class="p">::</span><span class="n">Expr</span> <span class="o">&gt;&gt;</span> <span class="s">"then"</span> <span class="o">&gt;&gt;</span> <span class="nn">Matcher</span><span class="p">::</span><span class="n">Expr</span>
<span class="k">let</span> <span class="n">if_then_else</span> <span class="o">=</span> <span class="s">"if"</span> <span class="o">&gt;&gt;</span> <span class="nn">Matcher</span><span class="p">::</span><span class="n">Expr</span> <span class="o">&gt;&gt;</span> <span class="s">"then"</span> <span class="o">&gt;&gt;</span> <span class="nn">Matcher</span><span class="p">::</span><span class="n">Expr</span> <span class="o">&gt;&gt;</span> <span class="s">"else"</span> <span class="o">&gt;&gt;</span> <span class="nn">Matcher</span><span class="p">::</span><span class="n">Expr</span>
</code></pre></div></div>

<p>These generate a tree as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                       ┌──────┐
                       │ "if" │
                       └──────┘
                           │
                           ├─────────────────┐
                           ▼                 ▼
                   ┌───────────────┐     ┌───────┐
                   │ Matcher::Expr │     │ Other │
                   └───────────────┘     └───────┘
                           │                 │
                           │                 │
                           ▼                 ▼
                       ┌──────┐          ┌──────┐
                       │"then"│          │ Fail │
                       └──────┘          └──────┘
                           │
                           ├─────────────────┐
                           ▼                 ▼
                   ┌───────────────┐     ┌───────┐
                   │ Matcher::Expr │     │ Other │
                   └───────────────┘     └───────┘
                           │                 │
       ┌───────────────────┤                 │
       ▼                   ▼                 ▼
  ┌─────────┐          ┌──────┐          ┌──────┐
  │ Succeed │          │"else"│          │ Fail │
  └─────────┘          └──────┘          └──────┘
                           │
                           ├─────────────────┐
                           ▼                 ▼
                   ┌───────────────┐     ┌───────┐
                   │ Matcher::Expr │     │ Other │
                   └───────────────┘     └───────┘
                           │                 │
                           │                 │
                           ▼                 ▼
                      ┌─────────┐        ┌──────┐
                      │ Succeed │        │ Fail │
                      └─────────┘        └──────┘
</code></pre></div></div>

<p>Within each of the patterns, the macro resolution continues recursively, thus
allowing the macros to match nested uses of themselves (e.g.
<code class="language-plaintext highlighter-rouge">if a then if b then c</code>).</p>

<p>In reality, this is not how it <em>actually</em> takes place. Applying one macro to
completion and then starting again on all remaining segments provides abysmal
complexity. As a result, the process instead operates on a <em>stack</em> of resolution
contexts, performing its resolution in a linear scan over the token stream.</p>

<h3 id="macro-segments">Macro Segments</h3>

<p>Macros are described in terms of <em>segments</em>. A segment consists of three main
components:</p>

<ol>
  <li>An optional <em>preceding section</em> that uses <a href="#macro-matchers">matchers</a> to
describe what they match until encountering the <em>literal</em> in 2. This can
only occur with the first segment.</li>
  <li>A <em>literal</em> that must be matched for that segment to apply.</li>
  <li>An optional associated <a href="#macro-matchers">matcher</a> that consumes certain
<em>types</em> of token.</li>
</ol>

<p>Segments determine how a given macro matches on the input token stream, and are
used to generate the tree for performing resolution.</p>

<h3 id="matching">Matching</h3>

<p>When a match occurs, the resultant segments are passed to a function that can
perform some action based on those segments. This function is responsible for
manipulating the output of the macro resolver, and hence manipulates the AST.</p>

<p>As the function may assert <em>additional</em> properties on the match not able to be
ascertained by the segment definitions themselves,</p>

<h2 id="macro-matchers">Macro Matchers</h2>

<p>The matchers describe the <em>kinds</em> of tokens that can be reasoned about within a
macro definition. These fall across a set of categories as follows.</p>

<p>The boundary matchers are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Start</code>: Matches the start of the line.</li>
  <li><code class="language-plaintext highlighter-rouge">End</code>: Matches the end of the line.</li>
</ul>

<p>Structural matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Nothing</code>: Never matches on any token.</li>
  <li><code class="language-plaintext highlighter-rouge">Any</code>: Matches on any token. This may become a family of tokens (e.g.
<code class="language-plaintext highlighter-rouge">AnyExpr</code>), and so on, for performance.</li>
  <li><code class="language-plaintext highlighter-rouge">Seq</code>: Matches on the contained matches in sequence.</li>
  <li><code class="language-plaintext highlighter-rouge">Or</code>: Matches on one of the contained matches.</li>
  <li><code class="language-plaintext highlighter-rouge">Many</code>: Matches on multiple of the given match.</li>
  <li><code class="language-plaintext highlighter-rouge">Except</code>: Matches on everything but the given pattern.</li>
</ul>

<p>Meta matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Build</code>: Performs AST resolution on the match, but this must become implicit.</li>
  <li><code class="language-plaintext highlighter-rouge">Err</code>: Allows ascribing a user-defined error to the failure of the contained
matcher.</li>
  <li><code class="language-plaintext highlighter-rouge">Tag</code>: Does nothing, but attaches string metadata to the result. This is very
useful for syntax highlighting.</li>
  <li><code class="language-plaintext highlighter-rouge">Exact</code>: Matches on an explicit AST.</li>
</ul>

<p>Identifier matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Referent</code>: Matches on a referent identifier.</li>
  <li><code class="language-plaintext highlighter-rouge">Variable</code>: Matches on a variable identifier.</li>
  <li><code class="language-plaintext highlighter-rouge">External</code>: Matches on an external identifier.</li>
  <li><code class="language-plaintext highlighter-rouge">Blank</code>: Matches the blank identifier (<code class="language-plaintext highlighter-rouge">_</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">Operator</code>: Matches on an operator identifier.</li>
  <li><code class="language-plaintext highlighter-rouge">Modifier</code>: Matches on a modifier identifier.</li>
  <li><code class="language-plaintext highlighter-rouge">Annotation</code>: Matches on an annotation identifier.</li>
</ul>

<p>Literal matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Number</code>: Matches on a literal number.</li>
  <li><code class="language-plaintext highlighter-rouge">Text</code>: Any text literal.</li>
  <li><code class="language-plaintext highlighter-rouge">TextLine</code>: Matches a single-line textual literal.</li>
  <li><code class="language-plaintext highlighter-rouge">TextInlineBlock</code>: Matches an inline-block textual literal.</li>
  <li><code class="language-plaintext highlighter-rouge">TextBlock</code>: Matches a block text literal.</li>
</ul>

<p>Comment matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DisableComment</code>: Matches a standard disable comment.</li>
  <li><code class="language-plaintext highlighter-rouge">DocComment</code>: Matches an Enso doc comment.</li>
</ul>

<p>Structural matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Block</code>: Matches an Enso block.</li>
</ul>

<p>Error matchers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DanglingBase</code>: Matches an erroneous base for a number literal.</li>
  <li><code class="language-plaintext highlighter-rouge">TextError</code>: Matches tokens representing error states during textual lexing.</li>
  <li><code class="language-plaintext highlighter-rouge">InvalidSuffix</code>: Matches an erroneous suffix token.</li>
  <li><code class="language-plaintext highlighter-rouge">Unrecognized</code>: Matches an unrecognised token.</li>
</ul>

<p>In addition, it is highly likely that some of these will be combined into
aggregate matchers that match one of many kinds of token.</p>

<h3 id="relative-precedence-matchers">Relative Precedence Matchers</h3>

<p>Where relevant, the matchers above may take an optional “maximum precedence” of
operator that they may match. This effectively serves to implement differing
precedences on either side of a literal operator being implemented via a macro,
and is important for correctly resolving the function arrow <code class="language-plaintext highlighter-rouge">-&gt;</code>.</p>

<h3 id="named-macros">Named Macros</h3>

<p>In addition to the basic matcher described above, we also need a <code class="language-plaintext highlighter-rouge">Named</code>,
matcher. The intent behind this matcher is that it allows you to refer to
existing macro definitions by name, and also provides for better error messages.</p>

<p>By convention, we aim for these names to be treated as qualified, based on the
package in which they’re declared. This convention should be followed for the
built-in macros as well, even if they can’t be overridden, as they may appear in
error messages.</p>

<h2 id="macro-resolution-errors">Macro Resolution Errors</h2>

<p>Due to the incredibly structured nature of the resolver it is quite possible for
the macro system to produce very detailed errors when resolution fails. This is
because it knows the path it took to get to the failure, and the expected tokens
or kinds of tokens at the failure site.</p>

<p>In addition, the resolver allows users to define their own errors through the
use of the <code class="language-plaintext highlighter-rouge">Err</code> matcher mentioned <a href="#macro-matchers">above</a>.</p>

<h3 id="macro-errors-as-parser-errors">Macro Errors as Parser Errors</h3>

<p>The wealth of information in a failed macro resolution brings the necessary
tools for the compiler to produce informative and detailed parsing errors.</p>

<blockquote>
  <p>The actionables for this section are:</p>

  <ul>
    <li>Determine how we ensure provision of failure information to the engine in a
useful format.</li>
  </ul>
</blockquote>

<h2 id="user-defined-macros">User-Defined Macros</h2>

<p>In the future we want to provide an Enso-level syntax that allows the user to
define syntactic macros for their programs, similar to how Rust exposes the
<code class="language-plaintext highlighter-rouge">macro_rules!</code> construct.</p>

<blockquote>
  <p>The actionables for this section are:</p>

  <ul>
    <li>Determine what this should look like in surface Enso.</li>
    <li>Determine exactly how the round-trip mechanic between the runtime and parser
should function.</li>
  </ul>
</blockquote>

<h2 id="benchmarking">Benchmarking</h2>

<p>All components of the macro resolver are accompanied by comprehensive benchmarks
in order to protect the performance-crucial code against regressions. These
benchmarks are written using
<a href="https://github.com/bheisler/criterion.rs">criterion.rs</a>, and cover all of the
performance critical functionality of the macro resolver.</p>

<p><strong>Baseline Commit:</strong> TBC (use the latest for now)</p>

<p>The benchmarking process for the macro resolver is as follows:</p>

<ol>
  <li>Check out the current <em>baseline commit</em>, listed above.</li>
  <li>In each of the benchmark files, change the configuration line reading
<code class="language-plaintext highlighter-rouge">.retain_baseline</code> to <code class="language-plaintext highlighter-rouge">.save_baseline</code>. This will save the current baseline
(taken on your machine).</li>
  <li>In <code class="language-plaintext highlighter-rouge">lexer_bench_sources.rs</code> change the line that reads <code class="language-plaintext highlighter-rouge">.retain_baseline</code> to
instead read <code class="language-plaintext highlighter-rouge">.save_baseline</code>. This will save the current baseline (taken on
your machine).</li>
  <li>Run the benchmarks using <code class="language-plaintext highlighter-rouge">cargo bench</code>.</li>
  <li>Once the baseline run has completed, change the above-mentioned lines back to
<code class="language-plaintext highlighter-rouge">.retain_baseline</code>. This will disable overwriting the saved baseline, and
will perform its regression reporting against it.</li>
  <li>Make your changes.</li>
  <li>Run the benchmark suite again. It will report any performance regressions in
the benchmark report, measured against your saved baseline.</li>
</ol>

<p>Unfortunately, the use of time-based benchmarks means that we can’t commit the
baseline to the repository. There is far too much variance between machines for
this to be useful.</p>

<h3 id="running-a-subset-of-the-benchmarks">Running a Subset of the Benchmarks</h3>

<p>The benchmarks are very comprehensive, testing all performance-critical paths of
the macro resolver. However, it can often be useful to run a subset of these.</p>

<p>There are two main tuning points for this:</p>

<ol>
  <li>The <em>sizes</em> of inputs being executed on, where relevant.</li>
  <li>The benchmarks being executed.</li>
</ol>

<p>While it is <em>possible</em> to tune the benchmarking config to decrease benchmarking
time, this is not recommended. The current settings are tuned to provide
reliable results.</p>

<h3 id="changing-the-macro-resolver">Changing the Macro Resolver</h3>

<p>When changing the macro resolver the <em>full</em> benchmark suite must be run against
the current baseline before the changes can be merged. This suite run must use
the provided settings for the benchmarking library, and should be performed
using the process described above.</p>

                        
                        

                    </section>
                </div>

                 <!--<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>-->
            </div>
        </div>
    </div>
</div>

                <a href="/docs/developer/enso/parser/lexer.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Lexer">
                    <i class="fa fa-angle-left"></i>
                </a>
                

                
                    <a href="/docs/developer/enso/parser/operator-resolution.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Operator Resolution">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},
            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper"],
                "facebook": true,
                "google": false,
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
            "theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Enso Developer Documentation",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "enso/parser/macro-resolution.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2021-06-29 16:53:35 +0000"
    },
    "basePath": "/docs/developer",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/docs/developer/gitbook/gitbook.js"></script>
<script src="/docs/developer/gitbook/theme.js"></script>

<script src="/docs/developer/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> --></body>
</html>