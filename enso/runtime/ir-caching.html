<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>IR Caching in the Enso Compiler · Enso Developer Documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="The developer documentation for the Enso compiler, runtime, and IDE..
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Enso.org"><link rel="stylesheet" href="/docs/developer/gitbook/style.css">
<link rel="stylesheet" href="/docs/developer/gitbook/gitbook-plugin-fontsettings/website.css">
<!-- <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css"> -->

<link rel="stylesheet" href="/docs/developer/gitbook/rouge-highlight-colorful.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/docs/developer/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/docs/developer/gitbook/images/favicon.ico" type="image/x-icon">
        

        
        


        
        
        

        
        
        

        
            <link rel="prev" href="/docs/developer/enso/runtime/instruments.html" />
        

        
    </head>
    <body>
        
        <div class="book"><div class="book-summary">
    <div id="search-searchbar">
    </div>
    <div class="post-list" id="search-hits">
        
      </div>
      <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>
    <nav role="navigation">
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/">
            
                <a href="/docs/developer/">
                    Home
                </a>
            </li>

            <li class="divider"></li>
            
            
            
            
            

            
            
        
            
            <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime ">
                    <a href="/docs/developer/enso/runtime">
                        Go back
                    </a>
                </li>
                <li class="divider"></li>
            
                
             
            
            
            
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/">
                    
                        <a href="/docs/developer/enso/runtime/">
                            
                                Enso Runtime
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/caching.html">
                    
                        <a href="/docs/developer/enso/runtime/caching.html">
                            
                                Caching
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/demand-analysis.html">
                    
                        <a href="/docs/developer/enso/runtime/demand-analysis.html">
                            
                                Demand Analysis
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/function-call-flow.html">
                    
                        <a href="/docs/developer/enso/runtime/function-call-flow.html">
                            
                                Function Calling Flow
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/runtime-features.html">
                    
                        <a href="/docs/developer/enso/runtime/runtime-features.html">
                            
                                Runtime Features
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/unbounded-recursion.html">
                    
                        <a href="/docs/developer/enso/runtime/unbounded-recursion.html">
                            
                                Unbounded Recursion
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/execution-server-flow.html">
                    
                        <a href="/docs/developer/enso/runtime/execution-server-flow.html">
                            
                                Execution Server Flow
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/builtin-base-methods.html">
                    
                        <a href="/docs/developer/enso/runtime/builtin-base-methods.html">
                            
                                Builtin Base Methods
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/searcher.html">
                    
                        <a href="/docs/developer/enso/runtime/searcher.html">
                            
                                Searcher
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/developer/enso/runtime/instruments.html">
                    
                        <a href="/docs/developer/enso/runtime/instruments.html">
                            
                                Instruments
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter active" data-level="1.2" data-path="/docs/developer/enso/runtime/ir-caching.html">
                    
                        <a href="/docs/developer/enso/runtime/ir-caching.html">
                            
                                IR Caching in the Enso Compiler
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            

            
        
        </ul>
    </nav>
</div>
<div class="book-body"><div class="body-inner">
    <div class="book-header" role="navigation">
        <!-- Title -->
        <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
                <a href="." >IR Caching in the Enso Compiler</a>
            
        </h1>
    </div>
    <div class="page-wrapper" tabindex="-1" role="main">
        <div class="page-inner">
            <div id="book-search-results">
                <div class="search-noresults">
                    <section class="normal markdown-section">
                        <h1 id="ir-caching-in-the-enso-compiler">IR Caching in the Enso Compiler</h1>

<p>One of the largest pain points for users of Enso at the moment is the fact that
it has to precompile the entire standard library on every project load. This is,
in essence, due to the fact that the current parser is abysmally slow, and
incredibly demanding. The obvious solution to improve this is to take the parser
out of the equation in its entirety, by serialising the parser’s output.</p>

<p>To that end, we want to serialise the Enso IR to a format that can later be read
back in, bypassing the parser entirely. Furthermore, we can move the boundary at
which this serialisation takes place to the end of the compiler pipeline,
thereby bypassing doing most of the compilation work, and further improving
startup performance.</p>

<!-- MarkdownTOC levels="2,3" autolink="true" -->

<ul>
  <li><a href="#serialising-the-ir">Serialising the IR</a>
    <ul>
      <li><a href="#breaking-links">Breaking Links</a></li>
    </ul>
  </li>
  <li><a href="#storing-the-ir">Storing the IR</a>
    <ul>
      <li><a href="#metadata-format">Metadata Format</a></li>
      <li><a href="#portability-guarantees">Portability Guarantees</a></li>
    </ul>
  </li>
  <li><a href="#loading-the-ir">Loading the IR</a>
    <ul>
      <li><a href="#integrity-checking">Integrity Checking</a></li>
      <li><a href="#error-handling">Error Handling</a></li>
    </ul>
  </li>
  <li><a href="#testing-the-serialisation">Testing the Serialisation</a></li>
</ul>

<!-- /MarkdownTOC -->

<h2 id="serialising-the-ir">Serialising the IR</h2>

<p>As the serialised IR doesn’t need to be read by anything other than Enso, we
need not use a representation that is portable between platforms. As a result,
we have picked the <code class="language-plaintext highlighter-rouge">Serializable</code> infrastructure that is <em>already present</em> on
the JVM. It has the following benefits:</p>

<ul>
  <li>It is able to serialise arbitrary object graphs while maintaining object
identity and tracking references. This cannot be disabled for <code class="language-plaintext highlighter-rouge">Serializable</code>,
but that is fine as we want it.</li>
  <li>It is built into the JVM and is hence guaranteed to be portable between
instances of the same JVM.</li>
  <li>It copes fine with highly-nested scala types, like our IR.</li>
</ul>

<p>In order to maximise the benefits of this process, we want to serialise the IR
as <em>late</em> in the compiler pipeline as possible. This means serialising it just
before the code generation step that generates Truffle nodes (before the
<code class="language-plaintext highlighter-rouge">RuntimeStubsGenerator</code> and <code class="language-plaintext highlighter-rouge">IrToTruffle</code> run).</p>

<p>This serialisation should take place in an <em>offloaded thread</em> so that it doesn’t
block the compiler from continuing.</p>

<h3 id="breaking-links">Breaking Links</h3>

<p>Doing this naïvely, however, means that we can inadvertently end up serialising
the entire module graph. This is due to the <code class="language-plaintext highlighter-rouge">BindingsMap</code>, which contains a
reference to the associated <code class="language-plaintext highlighter-rouge">runtime.Module</code>, from which there is a reference to
the <code class="language-plaintext highlighter-rouge">ModuleScope</code>. The <code class="language-plaintext highlighter-rouge">ModuleScope</code> may then reference other <code class="language-plaintext highlighter-rouge">runtime.Module</code>s
which all contain <code class="language-plaintext highlighter-rouge">IR.Module</code>s. Therefore, done in a silly fashion, we end up
serialising the entire reachable module graph. This is not what we want.</p>

<p>While the ideal way of solving this problem would be to customise the
serialisation and deserialisation process for the <code class="language-plaintext highlighter-rouge">BindingsMap</code>, the JVM’s
<code class="language-plaintext highlighter-rouge">Serializable</code> does not provide the ability to customise it enough to solve this
problem. Instead, we solve it using a preprocessing step:</p>

<ul>
  <li>We can modify <code class="language-plaintext highlighter-rouge">BindingsMap</code> and its child types to be able to contain an
unlinked module pointer
<code class="language-plaintext highlighter-rouge">case class ModulePointer(qualifiedName: List[String])</code> in place of a
<code class="language-plaintext highlighter-rouge">Module</code>.</li>
  <li>As the <code class="language-plaintext highlighter-rouge">MetadataStorage</code> type that holds the <code class="language-plaintext highlighter-rouge">BindingsMap</code> is mutable it can
be updated in place without having to reassemble the entire IR graph.</li>
  <li>Hence, we can traverse all the nodes in the <code class="language-plaintext highlighter-rouge">ir.preorder</code> that have metadata
consisting of either the <code class="language-plaintext highlighter-rouge">BindingsMap</code> or <code class="language-plaintext highlighter-rouge">ResolvedName</code> types (provided by
the following passes: <code class="language-plaintext highlighter-rouge">BindingAnalysis</code>, <code class="language-plaintext highlighter-rouge">MethodDefinitions</code>,
<code class="language-plaintext highlighter-rouge">UppercaseNames</code>, <code class="language-plaintext highlighter-rouge">VectorLiterals</code>, <code class="language-plaintext highlighter-rouge">Patterns</code>), and perform a replacement.</li>
</ul>

<p>Having done this, we have broken any links that the IR may hold between modules,
and can serialise each module individually.</p>

<p>This serialisation must take place <em>after</em> codegen has happened as it modifies
the IR in place. The compiler can handle giving it to the offloaded
serialisation thread. It <em>may</em> be necessary to <code class="language-plaintext highlighter-rouge">duplicate</code> the IR before handing
it to this thread, but this should be checked during development.</p>

<h2 id="storing-the-ir">Storing the IR</h2>

<p>The serialized IR needs to be stored in a location that is tied to the library
that it serializes. Despite this, we <em>also</em> want to be able to ship cached IR
with libraries. This leads to a two pronged solution where we check two
locations for the cache.</p>

<ol>
  <li><strong>With the Library:</strong> As libraries can have a hidden <code class="language-plaintext highlighter-rouge">.enso</code> directory, we
can use a path within that for caching. This should be
<code class="language-plaintext highlighter-rouge">$package/.enso/cache/ir/enso-$version/</code>, and can be accessed by extending
the <code class="language-plaintext highlighter-rouge">pkg</code> library to be aware of the cache directories.</li>
  <li><strong>Globally:</strong> As some library locations may not be writeable, we need to have
a global out-of-line cache that is used if the first one is not writeable.
This is located under <code class="language-plaintext highlighter-rouge">$ENSO_DATA</code> (whose location can be obtained from the
<code class="language-plaintext highlighter-rouge">RuntimeDistributionManager</code>), and is located under the path
<code class="language-plaintext highlighter-rouge">$ENSO_DATA/cache/ir/$hash/enso-$version/</code>, where <code class="language-plaintext highlighter-rouge">$hash</code> is the <code class="language-plaintext highlighter-rouge">SHA3-224</code>
hash of the tuple <code class="language-plaintext highlighter-rouge">(namespace, library_name, version)</code>, where
<code class="language-plaintext highlighter-rouge">version = SemVer | "local"</code>. This hash is computed by concatenating the
string representations of these fields.</li>
</ol>

<p>In each location, the IR is stored with the following assumptions:</p>

<ul>
  <li>The IR file is located in a directory modelled after its module path, followed
by a file named after the module itself with the extension <code class="language-plaintext highlighter-rouge">.ir</code> (e.g. the IR
for <code class="language-plaintext highlighter-rouge">Standard.Base.Data.Vector</code> is stored in <code class="language-plaintext highlighter-rouge">Standard/Base/Data/Vector.ir</code>).</li>
  <li>The <a href="#metadata-format">metadata</a> file is located in a directory modelled after
its module path, followed by a file named after the module itself with the
extension <code class="language-plaintext highlighter-rouge">.meta</code> (e.g. the metadata for <code class="language-plaintext highlighter-rouge">Standard.Base.Data.Vector.enso</code> is
stored in <code class="language-plaintext highlighter-rouge">Standard/Base/Data/Vector.meta</code>). This is right next to the
corresponding <code class="language-plaintext highlighter-rouge">.ir</code> file.</li>
</ul>

<p>Storage of the IR only takes place iff the intended location for that IR is
<em>empty</em>.</p>

<h3 id="metadata-format">Metadata Format</h3>

<p>The metadata is used for integrity checking of the cached IR to prevent loading
corrupted or out of date data from the cache. Due to the fact that engines can
only load IR created by their versions, and cached IR is located in a directory
named after the engine version, this format need not be forward compatible.</p>

<p>It is a JSON file as follows:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">sourceHash</span><span class="p">:</span> <span class="nb">String</span><span class="p">;</span> <span class="c1">// The hash of the corresponding source file.</span>
  <span class="nl">blobHash</span><span class="p">:</span> <span class="nb">String</span><span class="p">;</span> <span class="c1">// The hash of the blob.</span>
  <span class="nl">compilationStage</span><span class="p">:</span> <span class="nb">String</span><span class="p">;</span> <span class="c1">// The compilation stage of the IR.</span>
<span class="p">}</span>
</code></pre></div></div>

<p>All hashes are encoded in SHA3-224 format, as is used by other components in the
Engine. The engine version is encoded in the cache path, and hence does not need
to be explicitly specified in the metadata.</p>

<h3 id="portability-guarantees">Portability Guarantees</h3>

<p>As part of this design we provide only the following portability guarantees:</p>

<ul>
  <li>The serialised IR must be able to be deserialised by <em>the same version of
Enso</em> that wrote the original blob.</li>
</ul>

<h2 id="loading-the-ir">Loading the IR</h2>

<p>Loading the IR is a multi-stage process that involves performing integrity
checking on the loaded cache. It works as follows.</p>

<ol>
  <li><strong>Find the Cache:</strong> Look in the global cache directory under <code class="language-plaintext highlighter-rouge">$ENSO_DATA</code>. If
there is no cached IR here that is valid for the current configuration, check
the ibrary’s <code class="language-plaintext highlighter-rouge">.enso/cache</code> folder. This should be hooked into in
<code class="language-plaintext highlighter-rouge">Compiler::parseModule</code>.</li>
  <li><strong>Check Integrity:</strong> Check the module’s <a href="#metadata-format">metadata</a> for
validity according to the <a href="#integrity-checking">integrity rules</a>.</li>
  <li><strong>Load:</strong> If the cache passes the integrity check, load the <code class="language-plaintext highlighter-rouge">.ir</code> file. If
deserialisation fails in any way, immediately fall back to parsing the source
file.</li>
  <li><strong>Re-Link:</strong> If loading completed successfully, re-link the <code class="language-plaintext highlighter-rouge">BindingsMap</code>
metadata to the proper modules in question.</li>
</ol>

<p>The main subtlety here is handling the dependencies between modules. We need to
ensure that, when loading multiple cached libraries, we properly handle them
one-by-one. Doing this is as simple as hooking into <code class="language-plaintext highlighter-rouge">Compiler::parseModule</code> and
setting <code class="language-plaintext highlighter-rouge">AFTER_STATIC_PASSES</code> as the compilation state after loading the module.
This will tie into the current <code class="language-plaintext highlighter-rouge">ImportsResolver</code> and <code class="language-plaintext highlighter-rouge">ExportsResolver</code> which are
run in an un-gated fashion in <code class="language-plaintext highlighter-rouge">Compiler::run</code>.</p>

<p>In order to prevent the execution of malicious code when deserialising we should
employ a deserialisation filter as built into the JDK.</p>

<h3 id="integrity-checking">Integrity Checking</h3>

<p>For a cache to be usable, the following properties need to be satisfied:</p>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">sourceHash</code> must match the hash of the corresponding source file.</li>
  <li>The <code class="language-plaintext highlighter-rouge">blobHash</code> must match the hash of the corresponding <code class="language-plaintext highlighter-rouge">.ir</code> file.</li>
</ol>

<p>If any of these fail, the cache file should be deleted where possible, or
ignored if it is in a read-only location.</p>

<h3 id="error-handling">Error Handling</h3>

<p>It is important, as part of this, that we fail under all circumstances into a
working state. This means that:</p>

<ul>
  <li>If serialisation fails, we report a low-priority error message and continue.</li>
  <li>If deserialisation fails, we fall back to loading and parsing the original
source file.</li>
</ul>

<p>At no point should this mechanism be exposed to the user in any visible way,
other than the fact that they may be seeing the actual files on disk.</p>

<h2 id="testing-the-serialisation">Testing the Serialisation</h2>

<p>There are two main elements that need to be tested as part of this feature.</p>

<ul>
  <li>Firstly, we need to test the serialisation and deserialisation process,
including the rewrite of <code class="language-plaintext highlighter-rouge">BindingsMap</code> to work properly.</li>
  <li>We also need to test the discovery of cache locations on the filesystem and
cache eviction strategies. The best way to do this is to set <code class="language-plaintext highlighter-rouge">$ENSO_DATA</code> to a
temporary directory and then directly interact with the filesystem. Caching
should be disabled for existing tests. This will require adding additional
runtime options for debugging, but also constructing the <code class="language-plaintext highlighter-rouge">DistributionManager</code>
on context creation (removing <code class="language-plaintext highlighter-rouge">RuntimeDistributionManager</code>).</li>
</ul>

                        
                        

                    </section>
                </div>

                 <!--<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `/docs/developer${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>-->
            </div>
        </div>
    </div>
</div>

                <a href="/docs/developer/enso/runtime/instruments.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Instruments">
                    <i class="fa fa-angle-left"></i>
                </a>
                

                
            
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},
            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper"],
                "facebook": true,
                "google": false,
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
            "theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Enso Developer Documentation",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "enso/runtime/ir-caching.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2021-07-27 16:14:29 +0000"
    },
    "basePath": "/docs/developer",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/docs/developer/gitbook/gitbook.js"></script>
<script src="/docs/developer/gitbook/theme.js"></script>

<script src="/docs/developer/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> --></body>
</html>